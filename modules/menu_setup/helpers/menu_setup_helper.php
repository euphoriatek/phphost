<?php

use app\services\utilities\Arr;

defined('BASEPATH') or exit('No direct script access allowed');

function app_admin_sidebar_custom_options($items)
{
    return _apply_menu_items_options($items, json_decode(get_option('aside_menu_active')));
}

function app_admin_sidebar_custom_positions($items)
{
    return _apply_menu_items_position($items, json_decode(get_option('aside_menu_active')));
}

function app_admin_setup_menu_custom_options($items)
{
    return _apply_menu_items_options($items, json_decode(get_option('setup_menu_active')));
}

function app_admin_setup_menu_custom_positions($items)
{
    return _apply_menu_items_position($items, json_decode(get_option('setup_menu_active')));
}

function _apply_menu_items_options($items, $options)
{
    foreach ($items as $key => $item) {
        if (isset($options->{$item['slug']})) {
            if (isset($options->{$item['slug']}->disabled)
                && $options->{$item['slug']}->disabled === 'true') {
                // Main item is disabled
                unset($items[$key]);
            } else {
                // Main item has custom icon
                if (isset($options->{$item['slug']}->icon) && $options->{$item['slug']}->icon === false) {
                    // False is when user set the icon empty from the builder
                    $items[$key]['icon'] = '';
                } elseif (!empty($options->{$item['slug']}->icon)) {
                    $items[$key]['icon'] = $options->{$item['slug']}->icon;
                }
            }

            foreach ($item['children'] as $childKey => $child) {
                if (isset($options->{$item['slug']}->children->{$child['slug']})) {
                    if (isset($options->{$item['slug']}->children->{$child['slug']}->disabled)
                        && $options->{$item['slug']}->children->{$child['slug']}->disabled === 'true') {
                        // Is disabled
                        unset($items[$key]['children'][$childKey]);
                    } else {
                        // Has custom icon
                        if ($options->{$item['slug']}->children->{$child['slug']}->icon === false) {
                            $items[$key]['children'][$childKey]['icon'] = '';
                        } elseif (!empty($options->{$item['slug']}->children->{$child['slug']}->icon)) {
                            $items[$key]['children'][$childKey]['icon'] = $options->{$item['slug']}->children->{$child['slug']}->icon;
                        }
                    }
                }
            }
        }
    }

    return $items;
}

function _apply_menu_items_position($items, $options)
{
    if (!is_array($options)) {
        $CI = &get_instance();
        // Has applied options
        $newItems          = [];
        $newItemsAddedKeys = [];

        foreach ($options as $key => $item) {
            // Check if the item is found because can be removed
            if ($newItem = $CI->app_menu->filter_item($items, $item->id)) {
                $newItems[$key]      = $newItem;
                $newItemsAddedKeys[] = $key;

                $newItems[$key]['children'] = [];

                if (isset($item->children)) {
                    foreach ($item->children as $child) {
                        if ($newChildItem = $CI->app_menu->filter_item($items, $child->id)) {
                            $newItems[$key]['children'][] = $newChildItem;
                            $newItemsAddedKeys[]          = $newChildItem['slug'];
                        }
                    }
                }
            }
        }

        // Let's check if item is missed from $items to $newItems
        foreach ($items as $key => $item) {
            if (!in_array($key, $newItemsAddedKeys)) {
                $newItems[$key] = $item;
            }

            if (isset($item['collapse'])) {
                foreach ($item['children'] as $childKey => $child) {
                    if (!in_array($child['slug'], $newItemsAddedKeys)) {
                        $newItems[$key]['children'][] = $child;
                    }
                }

                $newItems[$key]['children'] = Arr::uniqueByKey($newItems[$key]['children'], 'slug');
            }
        }

        $items = $newItems;
    }

    // Finally apply the positions
    foreach ($items as $key => $item) {
        if (isset($options->{$item['slug']})) {
            $items[$key]['position'] = (int) $options->{$item['slug']}->position;

            foreach ($item['children'] as $childKey => $child) {
                if (isset($options->{$item['slug']}->children->{$child['slug']})) {
                    $items[$key]['children'][$childKey]['position'] = (int) $options->{$item['slug']}->children->{$child['slug']}->position;
                }
            }
        }
    }

    return $items;
}

function _menu_options_filter_child($menu_options, $slug)
{
    foreach ($menu_options as $option) {
        if (isset($option->children)) {
            foreach ($option->children as $childKey => $child) {
                if (!empty($child->id)) {
                    if ($child->id == $slug) {
                        return $child;
                    }
                }
            }
        }
    }

    return false;
}

function app_get_menu_setup_icon($menu_options, $slug, $group)
{
    $child = _menu_options_filter_child($menu_options, $slug);

    // No options applied
    if (!isset($menu_options->{$slug}) && $child === false) {
        return get_instance()->app_menu->get_initial_icon($slug, $group);
    }

    // Icon is set empty by user on parent item
    if (isset($menu_options->{$slug})
        && $menu_options->{$slug}->icon === false) {
        return '';
    }

    // Icon is set empty by user on child item
    if ($child !== false && $child->icon === false) {
        return '';
    }

    // no icon applied, get the initial icon
    if (isset($menu_options->{$slug}) && $menu_options->{$slug}->icon === '') {
        return get_instance()->app_menu->get_initial_icon($slug, $group);
    } elseif (isset($menu_options->{$slug})) {
        // Custom icon is set on parent
        return $menu_options->{$slug}->icon;
    }
    // no icon applied, get the initial icon
    if ($child && $child->icon === '') {
        return get_instance()->app_menu->get_initial_icon($slug, $group);
    } elseif ($child) {
        // Custom icon is set on child
        return $child->icon;
    }

    return '';
}

if (!function_exists('aside_menu_active_json')) {
    function aside_menu_active_json()
    {
        return '{"dashboard":{"id":"dashboard","icon":false,"tooltip":"","disabled":"false","position":1},"accounting":{"id":"accounting","icon":"","tooltip":"","disabled":"false","position":"10","children":{"accounting_dashboard":{"disabled":"false","id":"accounting_dashboard","icon":"","tooltip":"","position":"5"},"accounting_banking":{"disabled":"false","id":"accounting_banking","icon":"","tooltip":"","position":"10"},"accounting_transaction":{"disabled":"false","id":"accounting_transaction","icon":"","tooltip":"","position":"15"},"accounting_journal_entry":{"disabled":"false","id":"accounting_journal_entry","icon":"","tooltip":"","position":"20"},"accounting_transfer":{"disabled":"false","id":"accounting_transfer","icon":"","tooltip":"","position":"25"},"accounting_chart_of_accounts":{"disabled":"false","id":"accounting_chart_of_accounts","icon":"","tooltip":"","position":"30"},"accounting_reconcile":{"disabled":"false","id":"accounting_reconcile","icon":"","tooltip":"","position":"35"},"accounting_budget":{"disabled":"false","id":"accounting_budget","icon":"","tooltip":"","position":"40"},"accounting_report":{"disabled":"false","id":"accounting_report","icon":"","tooltip":"","position":"45"},"accounting_setting":{"disabled":"false","id":"accounting_setting","icon":"","tooltip":"","position":"50"}}},"OKR":{"id":"OKR","icon":"","tooltip":"","disabled":"false","position":"15","children":{"okr_dashboard":{"disabled":"false","id":"okr_dashboard","icon":"","tooltip":"","position":"5"},"okrs":{"disabled":"false","id":"okrs","icon":"","tooltip":"","position":"10"},"okr_checkin":{"disabled":"false","id":"okr_checkin","icon":"","tooltip":"","position":"15"},"okr_setting":{"disabled":"false","id":"okr_setting","icon":"","tooltip":"","position":"20"}}},"reports":{"id":"reports","icon":"","tooltip":"","disabled":"false","position":"20","children":{"sales-reports":{"disabled":"false","id":"sales-reports","icon":"","tooltip":"","position":"5"},"order_report":{"disabled":"false","id":"order_report","icon":"","tooltip":"","position":"10"},"quantities_report":{"disabled":"false","id":"quantities_report","icon":"","tooltip":"","position":"15"},"expenses-reports":{"disabled":"false","id":"expenses-reports","icon":"","tooltip":"","position":"20"},"expenses-vs-income-reports":{"disabled":"false","id":"expenses-vs-income-reports","icon":"","tooltip":"","position":"25"},"leads-reports":{"disabled":"false","id":"leads-reports","icon":"","tooltip":"","position":"30"},"timesheets-reports":{"disabled":"false","id":"timesheets-reports","icon":"","tooltip":"","position":"35"},"knowledge-base-reports":{"disabled":"false","id":"knowledge-base-reports","icon":"","tooltip":"","position":"40"}}},"team_password":{"id":"team_password","icon":"","tooltip":"","disabled":"false","position":"25","children":{"team_password-dashboard":{"disabled":"false","id":"team_password-dashboard","icon":"","tooltip":"","position":"5"},"team_password_management":{"disabled":"false","id":"team_password_management","icon":"","tooltip":"","position":"10"},"team_password_category_management":{"disabled":"false","id":"team_password_category_management","icon":"","tooltip":"","position":"15"},"team_password-report":{"disabled":"false","id":"team_password-report","icon":"","tooltip":"","position":"20"},"tp-setting":{"disabled":"false","id":"tp-setting","icon":"","tooltip":"","position":"25"}}},"commission":{"id":"commission","icon":"","tooltip":"","disabled":"false","position":"30","children":{"manage-commission":{"disabled":"false","id":"manage-commission","icon":"","tooltip":"","position":"5"},"commission-receipt":{"disabled":"false","id":"commission-receipt","icon":"","tooltip":"","position":"10"},"commission-applicable-staff":{"disabled":"false","id":"commission-applicable-staff","icon":"","tooltip":"","position":"15"},"commission-applicable-client":{"disabled":"false","id":"commission-applicable-client","icon":"","tooltip":"","position":"20"},"commission-policy":{"disabled":"false","id":"commission-policy","icon":"","tooltip":"","position":"25"},"commission-setting":{"disabled":"false","id":"commission-setting","icon":"","tooltip":"","position":"30"}}},"mailbox":{"id":"mailbox","icon":"","tooltip":"","disabled":"false","position":"35"},"prchat":{"id":"prchat","icon":"","tooltip":"","disabled":"false","position":"40"},"si_todo_menu":{"id":"si_todo_menu","icon":"","tooltip":"","disabled":"false","position":"45","children":{"si-todo-list-menu":{"disabled":"false","id":"si-todo-list-menu","icon":"","tooltip":"","position":"5"},"si-todo-category-menu":{"disabled":"false","id":"si-todo-category-menu","icon":"","tooltip":"","position":"10"},"si-todo-settings-menu":{"disabled":"false","id":"si-todo-settings-menu","icon":"","tooltip":"","position":"15"}}},"SPREADSHEET_ONLINE":{"id":"SPREADSHEET_ONLINE","icon":"","tooltip":"","disabled":"false","position":"50"},"FILE_SHARING":{"id":"FILE_SHARING","icon":"","tooltip":"","disabled":"false","position":"55","children":{"file_sharing_management":{"disabled":"false","id":"file_sharing_management","icon":"","tooltip":"","position":"5"},"file_sharing_sharings":{"disabled":"false","id":"file_sharing_sharings","icon":"","tooltip":"","position":"10"},"file_sharing_download_management":{"disabled":"false","id":"file_sharing_download_management","icon":"","tooltip":"","position":"15"},"file_sharing_report":{"disabled":"false","id":"file_sharing_report","icon":"","tooltip":"","position":"20"},"file_sharing_setting":{"disabled":"false","id":"file_sharing_setting","icon":"","tooltip":"","position":"25"}}},"ma":{"id":"ma","icon":"","tooltip":"","disabled":"false","position":"60","children":{"ma-dashboard":{"disabled":"false","id":"ma-dashboard","icon":"","tooltip":"","position":"5"},"ma-segments":{"disabled":"false","id":"ma-segments","icon":"","tooltip":"","position":"10"},"ma-components":{"disabled":"false","id":"ma-components","icon":"","tooltip":"","position":"15"},"ma-campaigns":{"disabled":"false","id":"ma-campaigns","icon":"","tooltip":"","position":"20"},"ma-channels":{"disabled":"false","id":"ma-channels","icon":"","tooltip":"","position":"25"},"ma-points":{"disabled":"false","id":"ma-points","icon":"","tooltip":"","position":"30"},"ma-stages":{"disabled":"false","id":"ma-stages","icon":"","tooltip":"","position":"35"},"ma-reports":{"disabled":"false","id":"ma-reports","icon":"","tooltip":"","position":"40"},"ma-settings":{"disabled":"false","id":"ma-settings","icon":"","tooltip":"","position":"45"}}},"landingpages-menu":{"id":"landingpages-menu","icon":"","tooltip":"","disabled":"false","position":"65","children":{"landingpages":{"disabled":"false","id":"landingpages","icon":"","tooltip":"","position":"5"},"landingpages-templates":{"disabled":"false","id":"landingpages-templates","icon":"","tooltip":"","position":"10"},"landingpages-leads":{"disabled":"false","id":"landingpages-leads","icon":"","tooltip":"","position":"15"},"landingpages-blocks":{"disabled":"false","id":"landingpages-blocks","icon":"","tooltip":"","position":"20"},"landingpages-setting":{"disabled":"false","id":"landingpages-setting","icon":"","tooltip":"","position":"25"}}},"custom-email-and-sms":{"id":"custom-email-and-sms","icon":"","tooltip":"","disabled":"false","position":"70","children":{"add_edit_templates":{"disabled":"false","id":"add_edit_templates","icon":"","tooltip":"","position":"5"},"main-menu-options":{"disabled":"false","id":"main-menu-options","icon":"","tooltip":"","position":"10"}}},"subscriptions":{"id":"subscriptions","icon":false,"tooltip":"","disabled":"true","position":"75"},"affiliate":{"id":"affiliate","icon":"","tooltip":"","disabled":"false","position":"80","children":{"affiliate-dashboard":{"disabled":"false","id":"affiliate-dashboard","icon":"","tooltip":"","position":"5"},"affiliate-members":{"disabled":"false","id":"affiliate-members","icon":"","tooltip":"","position":"10"},"affiliate-programs":{"disabled":"false","id":"affiliate-programs","icon":"","tooltip":"","position":"15"},"affiliate-orders":{"disabled":"false","id":"affiliate-orders","icon":"","tooltip":"","position":"20"},"affiliate-logs":{"disabled":"false","id":"affiliate-logs","icon":"","tooltip":"","position":"25"},"affiliate-wallet":{"disabled":"false","id":"affiliate-wallet","icon":"","tooltip":"","position":"30"},"affiliate-reports":{"disabled":"false","id":"affiliate-reports","icon":"","tooltip":"","position":"35"},"affiliate-setting":{"disabled":"false","id":"affiliate-setting","icon":"","tooltip":"","position":"40"}}},"appointly":{"id":"appointly","icon":"","tooltip":"","disabled":"false","position":"85","children":{"appointly-user-dashboard":{"disabled":"false","id":"appointly-user-dashboard","icon":"","tooltip":"","position":"5"},"appointly-user-history":{"disabled":"false","id":"appointly-user-history","icon":"","tooltip":"","position":"10"},"appointly-callbacks":{"disabled":"false","id":"appointly-callbacks","icon":"","tooltip":"","position":"15"},"appointly-user-settings":{"disabled":"false","id":"appointly-user-settings","icon":"","tooltip":"","position":"20"},"appointly-link-menu-form":{"disabled":"false","id":"appointly-link-menu-form","icon":"","tooltip":"","position":"25"}}},"zoom_meetings":{"id":"zoom_meetings","icon":"","tooltip":"","disabled":"false","position":"90","children":{"send-zoom_meetings":{"disabled":"false","id":"send-zoom_meetings","icon":"","tooltip":"","position":"5"},"create-meeting":{"disabled":"false","id":"create-meeting","icon":"","tooltip":"","position":"10"},"meeting-registrant":{"disabled":"false","id":"meeting-registrant","icon":"","tooltip":"","position":"15"},"api-meeting":{"disabled":"false","id":"api-meeting","icon":"","tooltip":"","position":"20"}}},"custom-reports":{"id":"custom-reports","icon":"","tooltip":"","disabled":"false","position":"95","children":{"tasks-report-options":{"disabled":"false","id":"tasks-report-options","icon":"","tooltip":"","position":"5"},"clients-report-options":{"disabled":"false","id":"clients-report-options","icon":"","tooltip":"","position":"10"}}},"task_bookmarks":{"id":"task_bookmarks","icon":"","tooltip":"","disabled":"false","position":"100"},"tasks":{"id":"tasks","icon":"","tooltip":"","disabled":"false","position":"105"},"lead_manager":{"id":"lead_manager","icon":"","tooltip":"","disabled":"false","position":"110","children":{"lead_manager_dashboard":{"disabled":"false","id":"lead_manager_dashboard","icon":"","tooltip":"","position":"5"},"lead_manager_appointment":{"disabled":"false","id":"lead_manager_appointment","icon":"","tooltip":"","position":"10"},"lead_manager_leads":{"disabled":"false","id":"lead_manager_leads","icon":"","tooltip":"","position":"15"},"lead_manager_chats":{"disabled":"false","id":"lead_manager_chats","icon":"","tooltip":"","position":"20"},"lead_manager_mailbox":{"disabled":"false","id":"lead_manager_mailbox","icon":"","tooltip":"","position":"25"}}},"leads":{"id":"leads","icon":false,"tooltip":"","disabled":"true","position":"115"},"estimate_request":{"id":"estimate_request","icon":false,"tooltip":"","disabled":"true","position":"120"},"omni_sales":{"id":"omni_sales","icon":"","tooltip":"","disabled":"false","position":"125","children":{"omni_sales_order_list":{"disabled":"false","id":"omni_sales_order_list","icon":"","tooltip":"","position":"5"},"omni_sales_channel":{"disabled":"false","id":"omni_sales_channel","icon":"","tooltip":"","position":"10"},"trade_discount":{"disabled":"false","id":"trade_discount","icon":"","tooltip":"","position":"15"},"omni_sales_diary_sync":{"disabled":"false","id":"omni_sales_diary_sync","icon":"","tooltip":"","position":"20"},"omni_sales_report":{"disabled":"false","id":"omni_sales_report","icon":"","tooltip":"","position":"25"},"omni_sales_pos":{"disabled":"false","id":"omni_sales_pos","icon":"","tooltip":"","position":"30"},"omni_sales_portal":{"disabled":"false","id":"omni_sales_portal","icon":"","tooltip":"","position":"35"},"omni_setting":{"disabled":"false","id":"omni_setting","icon":"","tooltip":"","position":"40"}}},"sales":{"id":"sales","icon":"","tooltip":"","disabled":"false","position":"130","children":{"proposals":{"disabled":"true","id":"proposals","icon":"","tooltip":"","position":"5"},"estimates":{"disabled":"false","id":"estimates","icon":"","tooltip":"","position":"10"},"invoices":{"disabled":"false","id":"invoices","icon":"","tooltip":"","position":"15"},"payments":{"disabled":"true","id":"payments","icon":"","tooltip":"","position":"20"},"credit_notes":{"disabled":"false","id":"credit_notes","icon":"","tooltip":"","position":"25"},"calendar":{"id":"calendar","disabled":"false","icon":"","tooltip":"","position":"30"},"items":{"disabled":"true","id":"items","icon":"","tooltip":"","position":"35"}}},"customers":{"id":"customers","icon":"","tooltip":"","disabled":"false","position":"135"},"loyalty":{"id":"loyalty","icon":"","tooltip":"","disabled":"false","position":"140","children":{"loyalty-user":{"disabled":"false","id":"loyalty-user","icon":"","tooltip":"","position":"5"},"loyalty-transation":{"disabled":"false","id":"loyalty-transation","icon":"","tooltip":"","position":"10"},"loyalty-mbs":{"disabled":"false","id":"loyalty-mbs","icon":"","tooltip":"","position":"15"},"loyalty-rule":{"disabled":"false","id":"loyalty-rule","icon":"","tooltip":"","position":"20"},"loyalty-config":{"disabled":"false","id":"loyalty-config","icon":"","tooltip":"","position":"25"}}},"contracts":{"id":"contracts","icon":false,"tooltip":"","disabled":"true","position":"145"},"diagramy_menu":{"id":"diagramy_menu","icon":"","tooltip":"","disabled":"false","position":"150"},"projects":{"id":"projects","icon":"","tooltip":"","disabled":"false","position":"155"},"manufacturing":{"id":"manufacturing","icon":"","tooltip":"","disabled":"false","position":"160","children":{"manufacturing_dashboard":{"disabled":"false","id":"manufacturing_dashboard","icon":"","tooltip":"","position":"5"},"manufacturing_product_management":{"disabled":"false","id":"manufacturing_product_management","icon":"","tooltip":"","position":"10"},"manufacturing_reception_of_staff":{"disabled":"false","id":"manufacturing_reception_of_staff","icon":"","tooltip":"","position":"15"},"manufacturing_hr_records":{"disabled":"false","id":"manufacturing_hr_records","icon":"","tooltip":"","position":"20"},"manufacturing_training":{"disabled":"false","id":"manufacturing_training","icon":"","tooltip":"","position":"25"},"manufacturing_q_a":{"disabled":"false","id":"manufacturing_q_a","icon":"","tooltip":"","position":"30"},"manufacturing_contract":{"disabled":"false","id":"manufacturing_contract","icon":"","tooltip":"","position":"35"},"manufacturing_dependent_person":{"disabled":"false","id":"manufacturing_dependent_person","icon":"","tooltip":"","position":"40"},"manufacturing_setting":{"disabled":"false","id":"manufacturing_setting","icon":"","tooltip":"","position":"45"}}},"products":{"id":"products","icon":"","tooltip":"","disabled":"false","position":"165","children":{"products":{"disabled":"false","id":"products","icon":"","tooltip":"","position":"5"},"products_categories":{"disabled":"false","id":"products_categories","icon":"","tooltip":"","position":"10"},"order_history":{"disabled":"false","id":"order_history","icon":"","tooltip":"","position":"15"},"add_new_order":{"disabled":"false","id":"add_new_order","icon":"","tooltip":"","position":"20"}}},"products_":{"id":"products_","icon":"","tooltip":"","disabled":"false","position":"170","children":{"services_products_invoice":{"disabled":"false","id":"services_products_invoice","icon":"","tooltip":"","position":"5"},"services_products_subscription":{"disabled":"false","id":"services_products_subscription","icon":"","tooltip":"","position":"10"},"services_products_groups":{"disabled":"false","id":"services_products_groups","icon":"","tooltip":"","position":"15"},"product_purchase_log":{"disabled":"false","id":"product_purchase_log","icon":"","tooltip":"","position":"20"}}},"warehouse":{"id":"warehouse","icon":"","tooltip":"","disabled":"false","position":"175","children":{"wa_commodity_list":{"disabled":"false","id":"wa_commodity_list","icon":"","tooltip":"","position":"5"},"wa_manage_goods_receipt":{"disabled":"false","id":"wa_manage_goods_receipt","icon":"","tooltip":"","position":"10"},"wa_manage_goods_delivery":{"disabled":"false","id":"wa_manage_goods_delivery","icon":"","tooltip":"","position":"15"},"wa_manage_packing_list":{"disabled":"false","id":"wa_manage_packing_list","icon":"","tooltip":"","position":"20"},"wa_manage_internal_delivery":{"disabled":"false","id":"wa_manage_internal_delivery","icon":"","tooltip":"","position":"25"},"wa_manage_loss_adjustment":{"disabled":"false","id":"wa_manage_loss_adjustment","icon":"","tooltip":"","position":"30"},"wa_manage_order_return":{"disabled":"false","id":"wa_manage_order_return","icon":"","tooltip":"","position":"35"},"wa_manage_warehouse":{"disabled":"false","id":"wa_manage_warehouse","icon":"","tooltip":"","position":"40"},"wa_warehouse_history":{"disabled":"false","id":"wa_warehouse_history","icon":"","tooltip":"","position":"45"},"wa_report":{"disabled":"false","id":"wa_report","icon":"","tooltip":"","position":"50"},"ware_settings":{"disabled":"false","id":"ware_settings","icon":"","tooltip":"","position":"55"}}},"fixed_equipment":{"id":"fixed_equipment","icon":"","tooltip":"","disabled":"false","position":"180","children":{"fixed_equipment_dashboard":{"disabled":"false","id":"fixed_equipment_dashboard","icon":"","tooltip":"","position":"5"},"fixed_equipment_assets":{"disabled":"false","id":"fixed_equipment_assets","icon":"","tooltip":"","position":"10"},"fixed_equipment_licenses":{"disabled":"false","id":"fixed_equipment_licenses","icon":"","tooltip":"","position":"15"},"fixed_equipment_accessories":{"disabled":"false","id":"fixed_equipment_accessories","icon":"","tooltip":"","position":"20"},"fixed_equipment_consumables":{"disabled":"false","id":"fixed_equipment_consumables","icon":"","tooltip":"","position":"25"},"fixed_equipment_components":{"disabled":"false","id":"fixed_equipment_components","icon":"","tooltip":"","position":"30"},"fixed_equipment_predefined_kits":{"disabled":"false","id":"fixed_equipment_predefined_kits","icon":"","tooltip":"","position":"35"},"fixed_equipment_checkout_mgt":{"disabled":"false","id":"fixed_equipment_checkout_mgt","icon":"","tooltip":"","position":"40"},"fixed_equipment_requested":{"disabled":"false","id":"fixed_equipment_requested","icon":"","tooltip":"","position":"45"},"fixed_equipment_assets_maintenances":{"disabled":"false","id":"fixed_equipment_assets_maintenances","icon":"","tooltip":"","position":"50"},"fixed_equipment_bulk_audit":{"disabled":"false","id":"fixed_equipment_bulk_audit","icon":"","tooltip":"","position":"55"},"fixed_equipment_depreciations":{"disabled":"false","id":"fixed_equipment_depreciations","icon":"","tooltip":"","position":"60"},"fixed_equipment_locations":{"disabled":"false","id":"fixed_equipment_locations","icon":"","tooltip":"","position":"65"},"fixed_equipment_report":{"disabled":"false","id":"fixed_equipment_report","icon":"","tooltip":"","position":"70"},"fixed_equipment_settings":{"disabled":"false","id":"fixed_equipment_settings","icon":"","tooltip":"","position":"75"}}},"supplier":{"id":"supplier","icon":"","tooltip":"","disabled":"false","position":"185"},"purchase":{"id":"purchase","icon":"","tooltip":"","disabled":"false","position":"190","children":{"purchase-items":{"disabled":"false","id":"purchase-items","icon":"","tooltip":"","position":"5"},"vendors":{"disabled":"false","id":"vendors","icon":"","tooltip":"","position":"10"},"vendors-items":{"disabled":"false","id":"vendors-items","icon":"","tooltip":"","position":"15"},"purchase-request":{"disabled":"false","id":"purchase-request","icon":"","tooltip":"","position":"20"},"purchase-quotation":{"disabled":"false","id":"purchase-quotation","icon":"","tooltip":"","position":"25"},"purchase-order":{"disabled":"false","id":"purchase-order","icon":"","tooltip":"","position":"30"},"purchase-contract":{"disabled":"false","id":"purchase-contract","icon":"","tooltip":"","position":"35"},"purchase-debit-note":{"disabled":"false","id":"purchase-debit-note","icon":"","tooltip":"","position":"40"},"purchase-invoices":{"disabled":"false","id":"purchase-invoices","icon":"","tooltip":"","position":"45"},"purchase_reports":{"disabled":"false","id":"purchase_reports","icon":"","tooltip":"","position":"50"},"purchase-settings":{"disabled":"false","id":"purchase-settings","icon":"","tooltip":"","position":"55"}}},"expenses":{"id":"expenses","icon":false,"tooltip":"","disabled":"true","position":"195"},"recruitment":{"id":"recruitment","icon":"","tooltip":"","disabled":"false","position":"200","children":{"recruitment_dashboard":{"disabled":"false","id":"recruitment_dashboard","icon":"","tooltip":"","position":"5"},"recruitment-campaign":{"disabled":"false","id":"recruitment-campaign","icon":"","tooltip":"","position":"10"},"candidate-profile":{"disabled":"false","id":"candidate-profile","icon":"","tooltip":"","position":"15"},"interview-schedule":{"disabled":"false","id":"interview-schedule","icon":"","tooltip":"","position":"20"},"recruitment-channel":{"disabled":"false","id":"recruitment-channel","icon":"","tooltip":"","position":"25"},"recruitment-portal":{"disabled":"false","id":"recruitment-portal","icon":"","tooltip":"","position":"30"},"rec_settings":{"disabled":"false","id":"rec_settings","icon":"","tooltip":"","position":"35"}}},"hr_profile":{"id":"hr_profile","icon":"","tooltip":"","disabled":"false","position":"205","children":{"hr_profile_dashboard":{"disabled":"false","id":"hr_profile_dashboard","icon":"","tooltip":"","position":"5"},"hr_profile_job_position_manage":{"disabled":"false","id":"hr_profile_job_position_manage","icon":"","tooltip":"","position":"10"},"hr_profile_organizational_chart":{"disabled":"false","id":"hr_profile_organizational_chart","icon":"","tooltip":"","position":"15"},"hr_profile_reception_of_staff":{"disabled":"false","id":"hr_profile_reception_of_staff","icon":"","tooltip":"","position":"20"},"hr_profile_hr_records":{"disabled":"false","id":"hr_profile_hr_records","icon":"","tooltip":"","position":"25"},"hr_profile_training":{"disabled":"false","id":"hr_profile_training","icon":"","tooltip":"","position":"30"},"hr_profile_contract":{"disabled":"false","id":"hr_profile_contract","icon":"","tooltip":"","position":"35"},"hr_profile_dependent_person":{"disabled":"false","id":"hr_profile_dependent_person","icon":"","tooltip":"","position":"40"},"hr_profile_quitting_works":{"disabled":"false","id":"hr_profile_quitting_works","icon":"","tooltip":"","position":"45"},"hr_profile_q_a":{"disabled":"false","id":"hr_profile_q_a","icon":"","tooltip":"","position":"50"},"hr_profile_reports":{"disabled":"false","id":"hr_profile_reports","icon":"","tooltip":"","position":"55"},"hr_profile_setting":{"disabled":"false","id":"hr_profile_setting","icon":"","tooltip":"","position":"60"}}},"hr_payroll":{"id":"hr_payroll","icon":"","tooltip":"","disabled":"false","position":"210","children":{"hr_manage_employees":{"disabled":"false","id":"hr_manage_employees","icon":"","tooltip":"","position":"5"},"hr_manage_attendance":{"disabled":"false","id":"hr_manage_attendance","icon":"","tooltip":"","position":"10"},"hr_manage_commissions":{"disabled":"false","id":"hr_manage_commissions","icon":"","tooltip":"","position":"15"},"hr_manage_deductions":{"disabled":"false","id":"hr_manage_deductions","icon":"","tooltip":"","position":"20"},"hr_bonus_kpi":{"disabled":"false","id":"hr_bonus_kpi","icon":"","tooltip":"","position":"25"},"hrp_insurrance":{"disabled":"false","id":"hrp_insurrance","icon":"","tooltip":"","position":"30"},"hr_pay_slips":{"disabled":"false","id":"hr_pay_slips","icon":"","tooltip":"","position":"35"},"hrp_payslip_template":{"disabled":"false","id":"hrp_payslip_template","icon":"","tooltip":"","position":"40"},"hrp_income_tax":{"disabled":"false","id":"hrp_income_tax","icon":"","tooltip":"","position":"45"},"hr_payroll_reports":{"disabled":"false","id":"hr_payroll_reports","icon":"","tooltip":"","position":"50"},"hrp_settings":{"disabled":"false","id":"hrp_settings","icon":"","tooltip":"","position":"55"}}},"resource_workload":{"id":"resource_workload","icon":"","tooltip":"","disabled":"false","position":"215","children":{"manage-resource-workload":{"disabled":"false","id":"manage-resource-workload","icon":"","tooltip":"","position":"5"},"applicable_staff":{"disabled":"false","id":"applicable_staff","icon":"","tooltip":"","position":"10"}}},"resource-booking":{"id":"resource-booking","icon":"","tooltip":"","disabled":"false","position":"220","children":{"booking":{"disabled":"false","id":"booking","icon":"","tooltip":"","position":"5"},"resource-group":{"disabled":"false","id":"resource-group","icon":"","tooltip":"","position":"10"},"resource":{"disabled":"false","id":"resource","icon":"","tooltip":"","position":"15"},"statisticals":{"disabled":"false","id":"statisticals","icon":"","tooltip":"","position":"20"}}},"timesheets":{"id":"timesheets","icon":"","tooltip":"","disabled":"false","position":"225","children":{"timesheets_timekeeping":{"disabled":"false","id":"timesheets_timekeeping","icon":"","tooltip":"","position":"5"},"timesheets_timekeeping_mnrh":{"disabled":"false","id":"timesheets_timekeeping_mnrh","icon":"","tooltip":"","position":"10"},"timesheets_table_shiftwork":{"disabled":"false","id":"timesheets_table_shiftwork","icon":"","tooltip":"","position":"15"},"timesheets_shift_management":{"disabled":"false","id":"timesheets_shift_management","icon":"","tooltip":"","position":"20"},"timesheets_shift_type":{"disabled":"false","id":"timesheets_shift_type","icon":"","tooltip":"","position":"25"},"timesheets-report":{"disabled":"false","id":"timesheets-report","icon":"","tooltip":"","position":"30"},"timesheets_setting":{"disabled":"false","id":"timesheets_setting","icon":"","tooltip":"","position":"35"}}},"feedback":{"id":"feedback","icon":"","tooltip":"","disabled":"false","position":"230","children":{"send-feedback":{"disabled":"false","id":"send-feedback","icon":"","tooltip":"","position":"5"},"feedback-received":{"disabled":"false","id":"feedback-received","icon":"","tooltip":"","position":"10"}}},"AIWRITER":{"id":"AIWRITER","icon":"","tooltip":"","disabled":"false","position":"235","children":{"writer":{"disabled":"false","id":"writer","icon":"","tooltip":"","position":"5"},"aiwriter-usage-case":{"disabled":"false","id":"aiwriter-usage-case","icon":"","tooltip":"","position":"10"},"aiwriter-setting":{"disabled":"false","id":"aiwriter-setting","icon":"","tooltip":"","position":"15"}}},"support":{"id":"support","icon":false,"tooltip":"","disabled":"true","position":"240"},"knowledge-base":{"id":"knowledge-base","icon":false,"tooltip":"","disabled":"true","position":"245"},"wiki-module-menu-wiki-master":{"id":"wiki-module-menu-wiki-master","icon":"","tooltip":"","disabled":"false","position":"250","children":{"wiki-books":{"disabled":"false","id":"wiki-books","icon":"","tooltip":"","position":"5"},"wiki-articles":{"disabled":"false","id":"wiki-articles","icon":"","tooltip":"","position":"10"},"wiki-articles-posted-by-me":{"disabled":"false","id":"wiki-articles-posted-by-me","icon":"","tooltip":"","position":"15"},"wiki-articles-bookmark":{"disabled":"false","id":"wiki-articles-bookmark","icon":"","tooltip":"","position":"20"}}},"mfa":{"id":"mfa","icon":"","tooltip":"","disabled":"false","position":"255","children":{"mfa-management":{"disabled":"false","id":"mfa-management","icon":"","tooltip":"","position":"5"},"mfa-report":{"disabled":"false","id":"mfa-report","icon":"","tooltip":"","position":"10"},"mfa-setting":{"disabled":"false","id":"mfa-setting","icon":"","tooltip":"","position":"15"}}},"webhooks":{"id":"webhooks","icon":"","tooltip":"","disabled":"false","position":"260","children":{"webhooks":{"disabled":"false","id":"webhooks","icon":"","tooltip":"","position":"5"},"webhook_log":{"disabled":"false","id":"webhook_log","icon":"","tooltip":"","position":"10"}}},"utilities":{"id":"utilities","icon":"","tooltip":"","disabled":"false","position":"265","children":{"media":{"disabled":"true","id":"media","icon":"","tooltip":"","position":"5"},"bulk-pdf-exporter":{"disabled":"true","id":"bulk-pdf-exporter","icon":"","tooltip":"","position":"10"},"announcements":{"disabled":"true","id":"announcements","icon":"","tooltip":"","position":"15"},"goals-tracking":{"disabled":"true","id":"goals-tracking","icon":"","tooltip":"","position":"20"},"activity-log":{"disabled":"true","id":"activity-log","icon":"","tooltip":"","position":"25"},"automation_manager":{"disabled":"true","id":"automation_manager","icon":"","tooltip":"","position":"30"},"surveys":{"disabled":"true","id":"surveys","icon":"","tooltip":"","position":"35"},"utility_backup":{"disabled":"true","id":"utility_backup","icon":"","tooltip":"","position":"40"},"ticket-pipe-log":{"disabled":"true","id":"ticket-pipe-log","icon":"","tooltip":"","position":"45"}}},"saas":{"id":"saas","icon":"","tooltip":"","disabled":"false","position":"270","children":{"plans":{"disabled":"false","id":"plans","icon":"","tooltip":"","position":"5"},"saas_setting":{"disabled":"false","id":"saas_setting","icon":"","tooltip":"","position":"10"},"saas_activity_log":{"disabled":"false","id":"saas_activity_log","icon":"","tooltip":"","position":"15"},"saas_landing_page_editor":{"disabled":"false","id":"saas_landing_page_editor","icon":"","tooltip":"","position":"20"},"saas_landing_page_builder":{"disabled":"false","id":"saas_landing_page_builder","icon":"","tooltip":"","position":"25"}}},"idea_hub":{"id":"idea_hub","icon":"","tooltip":"","disabled":"false","position":"275"}}';
    }
}

if (!function_exists('setup_menu_active_json')) {
    function setup_menu_active_json()
    {
        return '{"staff":{"id":"staff","icon":"","tooltip":"","disabled":"false","position":"5"},"customers":{"id":"customers","icon":"","tooltip":"","disabled":"false","position":"10","children":{"customer-groups":{"disabled":"true","id":"customer-groups","icon":"","tooltip":"","deactivated":"false","position":"5"}}},"idea_hub":{"id":"idea_hub","icon":"","tooltip":"","disabled":"false","position":"15","children":{"idea_hub-groups":{"disabled":"false","id":"idea_hub-groups","icon":"","tooltip":"","deactivated":"false","position":"5"}}},"support":{"id":"support","icon":"","tooltip":"","disabled":"false","position":"20","children":{"departments":{"disabled":"true","id":"departments","icon":"","tooltip":"","deactivated":"false","position":"5"},"tickets-predefined-replies":{"disabled":"true","id":"tickets-predefined-replies","icon":"","tooltip":"","deactivated":"false","position":"10"},"tickets-priorities":{"disabled":"true","id":"tickets-priorities","icon":"","tooltip":"","deactivated":"false","position":"15"},"tickets-statuses":{"disabled":"true","id":"tickets-statuses","icon":"","tooltip":"","deactivated":"false","position":"20"},"tickets-services":{"disabled":"true","id":"tickets-services","icon":"","tooltip":"","deactivated":"false","position":"25"},"tickets-spam-filters":{"disabled":"true","id":"tickets-spam-filters","icon":"","tooltip":"","deactivated":"false","position":"30"}}},"leads":{"id":"leads","icon":"","tooltip":"","disabled":"false","position":"25","children":{"leads-sources":{"disabled":"true","id":"leads-sources","icon":"","tooltip":"","deactivated":"false","position":"5"},"leads-statuses":{"disabled":"true","id":"leads-statuses","icon":"","tooltip":"","deactivated":"false","position":"10"},"leads-email-integration":{"disabled":"true","id":"leads-email-integration","icon":"","tooltip":"","deactivated":"false","position":"15"},"web-to-lead":{"disabled":"true","id":"web-to-lead","icon":"","tooltip":"","deactivated":"false","position":"20"}}},"menu-options":{"id":"menu-options","icon":"","tooltip":"","disabled":"false","position":"30","children":{"main-menu-options":{"disabled":"false","id":"main-menu-options","icon":"","tooltip":"","deactivated":"false","position":"5"},"setup-menu-options":{"disabled":"false","id":"setup-menu-options","icon":"","tooltip":"","deactivated":"false","position":"10"}}},"finance":{"id":"finance","icon":"","tooltip":"","disabled":"false","position":"35","children":{"taxes":{"disabled":"true","id":"taxes","icon":"","tooltip":"","deactivated":"false","position":"5"},"currencies":{"disabled":"true","id":"currencies","icon":"","tooltip":"","deactivated":"false","position":"10"},"payment-modes":{"disabled":"true","id":"payment-modes","icon":"","tooltip":"","deactivated":"false","position":"15"},"expenses-categories":{"disabled":"true","id":"expenses-categories","icon":"","tooltip":"","deactivated":"false","position":"20"}}},"contracts":{"id":"contracts","icon":"","tooltip":"","disabled":"false","position":"40","children":{"contracts-types":{"disabled":"true","id":"contracts-types","icon":"","tooltip":"","deactivated":"false","position":"5"}}},"extended_email":{"id":"extended_email","icon":"","tooltip":"","disabled":"false","position":"45","children":{"extended_email_form":{"disabled":"false","id":"extended_email_form","icon":"","tooltip":"","deactivated":"false","position":"5"},"extended_email_log_history":{"disabled":"false","id":"extended_email_log_history","icon":"","tooltip":"","deactivated":"false","position":"10"}}},"perfex_email_builder-menu":{"id":"perfex_email_builder-menu","icon":"","tooltip":"","disabled":"false","position":"50","children":{"edit_an_email_template":{"disabled":"false","id":"edit_an_email_template","icon":"","tooltip":"","deactivated":"false","position":"5"},"perfex_email_builder_options":{"disabled":"false","id":"perfex_email_builder_options","icon":"","tooltip":"","deactivated":"false","position":"10"}}},"gdpr":{"id":"gdpr","icon":"","tooltip":"","disabled":"false","position":"55"},"email-templates":{"id":"email-templates","icon":"","tooltip":"","disabled":"true","position":"60"},"custom-fields":{"id":"custom-fields","icon":"","tooltip":"","disabled":"false","position":"65"},"roles":{"id":"roles","icon":"","tooltip":"","disabled":"false","position":"70"},"elite_custom_js_css":{"id":"elite_custom_js_css","icon":"","tooltip":"","disabled":"false","position":"75","children":{"elite-custom-js":{"disabled":"false","id":"elite-custom-js","icon":"","tooltip":"","deactivated":"false","position":"5"},"elite-custom-css":{"disabled":"false","id":"elite-custom-css","icon":"","tooltip":"","deactivated":"false","position":"10"}}},"theme-style":{"id":"theme-style","icon":"","tooltip":"","disabled":"false","position":"80"},"whatsapp-chat":{"id":"whatsapp-chat","icon":"","tooltip":"","disabled":"false","position":"85"},"live-chat":{"id":"live-chat","icon":"","tooltip":"","disabled":"false","position":"90"},"support-contact":{"id":"support-contact","icon":"","tooltip":"","disabled":"false","position":"95"},"translations":{"id":"translations","icon":"","tooltip":"","disabled":"false","position":"100"},"custom_links":{"id":"custom_links","icon":"","tooltip":"","disabled":"false","position":"105"},"settings":{"id":"settings","icon":"","tooltip":"","disabled":"false","position":"110","children":{"general":{"disabled":"false","id":"general","icon":"","tooltip":"","deactivated":"false","position":"5"},"company":{"disabled":"false","id":"company","icon":"","tooltip":"","deactivated":"false","position":"10"},"localization":{"disabled":"false","id":"localization","icon":"","tooltip":"","deactivated":"false","position":"15"},"email":{"disabled":"false","id":"email","icon":"","tooltip":"","deactivated":"true","position":"20"},"sales":{"disabled":"false","id":"sales","icon":"","tooltip":"","deactivated":"true","position":"25"},"subscriptions":{"disabled":"false","id":"subscriptions","icon":"","tooltip":"","deactivated":"true","position":"30"},"payment_gateways":{"disabled":"false","id":"payment_gateways","icon":"","tooltip":"","deactivated":"false","position":"35"},"appointly-settings":{"disabled":"false","id":"appointly-settings","icon":"","tooltip":"","deactivated":"false","position":"40"},"diagramy":{"disabled":"false","id":"diagramy","icon":"","tooltip":"","deactivated":"false","position":"45"},"idea_hub":{"disabled":"false","id":"idea_hub","icon":"","tooltip":"","deactivated":"false","position":"50"},"lead_manager":{"disabled":"false","id":"lead_manager","icon":"","tooltip":"","deactivated":"false","position":"55"},"mailbox-settings":{"disabled":"false","id":"mailbox-settings","icon":"","tooltip":"","deactivated":"false","position":"60"},"prchat-settings":{"disabled":"false","id":"prchat-settings","icon":"","tooltip":"","deactivated":"false","position":"65"},"clients":{"disabled":"false","id":"clients","icon":"","tooltip":"","deactivated":"false","position":"70"},"tasks":{"disabled":"false","id":"tasks","icon":"","tooltip":"","deactivated":"false","position":"75"},"tickets":{"disabled":"false","id":"tickets","icon":"","tooltip":"","deactivated":"true","position":"80"},"saas":{"disabled":"false","id":"saas","icon":"","tooltip":"","deactivated":"false","position":"85"},"leads":{"disabled":"false","id":"leads","icon":"","tooltip":"","deactivated":"true","position":"90"},"products":{"disabled":"false","id":"products","icon":"","tooltip":"","deactivated":"false","position":"95"},"calendar":{"disabled":"false","id":"calendar","icon":"","tooltip":"","deactivated":"true","position":"100"},"sms":{"disabled":"false","id":"sms","icon":"","tooltip":"","deactivated":"true","position":"105"},"pdf":{"disabled":"false","id":"pdf","icon":"","tooltip":"","deactivated":"false","position":"110"},"e_sign":{"disabled":"false","id":"e_sign","icon":"","tooltip":"","deactivated":"false","position":"115"},"cronjob":{"disabled":"false","id":"cronjob","icon":"","tooltip":"","deactivated":"true","position":"120"},"tags":{"disabled":"false","id":"tags","icon":"","tooltip":"","deactivated":"true","position":"125"},"pusher":{"disabled":"false","id":"pusher","icon":"","tooltip":"","deactivated":"true","position":"130"},"google":{"disabled":"false","id":"google","icon":"","tooltip":"","deactivated":"true","position":"135"},"telegram_notification":{"disabled":"false","id":"telegram_notification","icon":"","tooltip":"","deactivated":"false","position":"140"},"misc":{"disabled":"false","id":"misc","icon":"","tooltip":"","deactivated":"true","position":"145"}}},"status_manager":{"id":"status_manager","icon":"","tooltip":"","disabled":"false","position":"115","children":{"task_status_manager":{"disabled":"false","id":"task_status_manager","icon":"","tooltip":"","deactivated":"false","position":"5"},"project_status_manager":{"disabled":"false","id":"project_status_manager","icon":"","tooltip":"","deactivated":"false","position":"10"}}},"estimate_request":{"id":"estimate_request","icon":"","tooltip":"","disabled":"false","position":"120","children":{"estimate-request-forms":{"id":"estimate-request-forms","disabled":"true","icon":"","tooltip":"","deactivated":"false","position":"5"},"estimate-request-statuses":{"id":"estimate-request-statuses","disabled":"true","icon":"","tooltip":"","deactivated":"false","position":"10"}}},"modules":{"id":"modules","icon":"","tooltip":"","disabled":"false","position":"125"},"inject-javascript":{"id":"inject-javascript","icon":"","tooltip":"","disabled":"false","position":"130"},"diagramy":{"id":"diagramy","icon":"","tooltip":"","disabled":"false","position":"135","children":{"diagramy-groups":{"disabled":"false","id":"diagramy-groups","icon":"","tooltip":"","deactivated":"false","position":"5"}}}}';
    }
}

if (!function_exists('moveSettingsTabToSidebarMenu')) {
    function moveSettingsTabToSidebarMenu($fullMenu=false)
    {
        $CI = &get_instance();
        $settingsTabs = $CI->app_tabs->get_settings_tabs();
        $settingsTabsValues = array_values($settingsTabs);

        $newArray = json_decode(get_option('setup_menu_active'), true);

        foreach ($settingsTabsValues as $index => &$subArray) {
            $subArray['icon'] = '';
            $subArray['parent_slug'] = 'settings';
            $subArray['href'] = admin_url('settings?group=' . $subArray['slug']);
            $subArray['tooltip'] = $newArray['settings']['children'][$subArray['slug']]['tooltip'] ?? "";
            if (!$fullMenu) {
                if (isset($newArray['settings'])) {
                    if ($newArray['settings']['children'][$subArray['slug']]['deactivated'] == 'true') {
                        unset($settingsTabsValues[$index]);
                    }
                }
            }
        }

        return $settingsTabsValues;
    }
}
